<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>D√≠as sin hablar de Augusto</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 60px 16px;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 25px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(120px, 160px));
      gap: 14px;
      justify-content: center;
      margin-bottom: 22px;
    }

    .box {
      background: #1b1b1b;
      border: 1px solid #2a2a2a;
      border-radius: 14px;
      padding: 18px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .num {
      font-size: 3rem;
      font-weight: 700;
      color: #00ffcc;
      line-height: 1.1;
    }

    .label {
      margin-top: 8px;
      font-size: 0.9rem;
      letter-spacing: 0.12em;
      color: #bdbdbd;
    }

    .row {
      display: flex;
      gap: 14px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }

    .record {
      display: inline-block;
      padding: 14px 18px;
      border-radius: 14px;
      background: #141414;
      border: 1px solid #2a2a2a;
    }

    .record-title {
      font-size: 0.85rem;
      letter-spacing: 0.14em;
      color: #bdbdbd;
      margin-bottom: 6px;
    }

    .record-value {
      font-size: 1.4rem;
      font-weight: 700;
    }

    button {
      font-size: 1.1rem;
      padding: 14px 22px;
      background: #ff4444;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    button:hover { background: #ff0000; }

    .status {
      display: block;
      margin-top: 14px;
      color: #aaa;
      min-height: 20px;
    }

    /* Responsive para celular */
    @media (max-width: 620px) {
      .grid {
        grid-template-columns: repeat(2, minmax(140px, 1fr));
      }
    }
  </style>
</head>

<body>
  <h1>D√≠as desde que Pablo habl√≥ de Augusto</h1>

  <div class="grid">
    <div class="box">
      <div class="num" id="dd">0</div>
      <div class="label">D√çAS</div>
    </div>
    <div class="box">
      <div class="num" id="hh">00</div>
      <div class="label">HORAS</div>
    </div>
    <div class="box">
      <div class="num" id="mm">00</div>
      <div class="label">MIN</div>
    </div>
    <div class="box">
      <div class="num" id="ss">00</div>
      <div class="label">SEG</div>
    </div>
  </div>

  <div class="row">
    <div class="record">
      <div class="record-title">R√âCORD</div>
      <div class="record-value" id="record">0d 00:00:00</div>
    </div>

    <button onclick="resetCounter()">Pablo habl√≥ de Augusto üò§</button>
  </div>

  <small class="status" id="lastReset"></small>
  <small class="status" id="status"></small>

  <script type="module">
    // Firebase (CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // ‚úÖ TU CONFIG (la de Firebase Console)
    const firebaseConfig = {
  apiKey: "AIzaSyAQIVQKnhNbBXK7q8rW0Lwr56wAhm5wjxE",
  authDomain: "contador-augusto.firebaseapp.com",
  databaseURL: "https://contador-augusto-default-rtdb.firebaseio.com",
  projectId: "contador-augusto",
  storageBucket: "contador-augusto.firebasestorage.app",
  messagingSenderId: "336307347194",
  appId: "1:336307347194:web:f6e141738a8ddc7ce5f343"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Ruta global compartida
    const counterRef = ref(db, "augustoCounter");

    const statusEl = document.getElementById("status");

    const pad2 = (n) => String(n).padStart(2, "0");

    function msToParts(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return { days, hours, minutes, seconds };
    }

    function formatMs(ms) {
      const { days, hours, minutes, seconds } = msToParts(ms);
      return `${days}d ${pad2(hours)}:${pad2(minutes)}:${pad2(seconds)}`;
    }

    // Estado local (pero viene del estado global)
    let lastResetMs = Date.now();
    let recordMs = 0;

    function paint() {
      const diffMs = Math.max(0, Date.now() - lastResetMs);
      const { days, hours, minutes, seconds } = msToParts(diffMs);

      document.getElementById("dd").innerText = days;
      document.getElementById("hh").innerText = pad2(hours);
      document.getElementById("mm").innerText = pad2(minutes);
      document.getElementById("ss").innerText = pad2(seconds);

      document.getElementById("record").innerText = formatMs(recordMs);
      document.getElementById("lastReset").innerText =
        "√öltima menci√≥n (global): " + new Date(lastResetMs).toLocaleString();
    }

    // Tick cada segundo (para que corra sin depender de Firebase)
    setInterval(paint, 1000);

    async function boot() {
      statusEl.textContent = "Conectando...";
      await signInAnonymously(auth);

      // Inicializa el contador en DB si a√∫n no existe
      await runTransaction(counterRef, (current) => {
        if (current && typeof current.lastResetMs === "number") return current;
        const now = Date.now();
        return { lastResetMs: now, recordMs: 0 };
      });

      // Escucha cambios en tiempo real
      onValue(counterRef, (snap) => {
        const data = snap.val();
        if (!data) return;

        if (typeof data.lastResetMs === "number") lastResetMs = data.lastResetMs;
        recordMs = typeof data.recordMs === "number" ? data.recordMs : 0;

        statusEl.textContent = "Sincronizado ‚úÖ";
        paint();
      });

      paint();
    }

    boot().catch((e) => {
      console.error("BOOT ERROR:", e);
      statusEl.textContent = "Error: revisa Console (F12)";
    });

    // Reset GLOBAL (para todos) + r√©cord at√≥mico
    async function resetCounter() {
      statusEl.textContent = "Reiniciando...";
      try {
        await runTransaction(counterRef, (current) => {
          const now = Date.now();

          if (!current || typeof current.lastResetMs !== "number") {
            return { lastResetMs: now, recordMs: 0 };
          }

          const diff = now - current.lastResetMs;
          const prevRecord = typeof current.recordMs === "number" ? current.recordMs : 0;

          return {
            lastResetMs: now,
            recordMs: Math.max(prevRecord, diff)
          };
        });

        statusEl.textContent = "Reiniciado ‚úÖ";
      } catch (e) {
        console.error("RESET ERROR:", e);
        statusEl.textContent = "Error al reiniciar (F12 ‚Üí Console)";
      }
    }

    // para el onclick del bot√≥n
    window.resetCounter = resetCounter;
  </script>
</body>
</html>
